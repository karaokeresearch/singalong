<html>
	<head>

		<title>Motion Instrument</title>
	</head>
	<body bgcolor=red>
		<script src="gyro.js"></script>
		<script src="howler.js"></script>
		<script type="text/javascript" src="teoria.js" ></script>
		<script>
			var waitedLongEnough=true;
			gyro.frequency=50;

			var loudness;
			var trueLoudness;
			var tone1;
			var tone2;
			var tone3;
			var tone4;

			var baseTone=[];

			baseTone[1] = new Howl({
				urls: ['1.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[2] = new Howl({
				urls: ['2.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[3] = new Howl({
				urls: ['3.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[4] = new Howl({
				urls: ['4.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[5] = new Howl({
				urls: ['5.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[6] = new Howl({
				urls: ['6.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[7] = new Howl({
				urls: ['7.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[8] = new Howl({
				urls: ['8.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[9] = new Howl({
				urls: ['9.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[10] = new Howl({
				urls: ['10.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[11] = new Howl({
				urls: ['11.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[12] = new Howl({
				urls: ['12.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[13] = new Howl({
				urls: ['13.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[14] = new Howl({
				urls: ['14.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[15] = new Howl({
				urls: ['15.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[16] = new Howl({
				urls: ['16.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[17] = new Howl({
				urls: ['17.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[18] = new Howl({
				urls: ['18.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[19] = new Howl({
				urls: ['19.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});


			baseTone[20] = new Howl({
				urls: ['20.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[21] = new Howl({
				urls: ['21.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[22] = new Howl({
				urls: ['22.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[23] = new Howl({
				urls: ['23.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});

			baseTone[24] = new Howl({
				urls: ['24.wav'],
				autoplay: true,
				loop: true,
				volume: 0
			});




			var changeChord = function (whichChord){
				var chordNotes =[];
				var chord=teoria.chord(whichChord);
				for (i=0; i< chord.notes().length; i++) {
					chordNotes.push((chord.notes()[i].key()+4)%24);
				}
				for (i=0; i< chord.notes().length; i++) {
					chordNotes.push(((chord.notes()[i].key()+16)%24));
				}
				chordNotes.sort(function(a, b){return a-b});

				var tempVol1=0;
				var tempVol2=0;
				var tempVol3=0;
				var tempVol4=0;


				if (tone1){
					tempVol1=tone1.volume();
				tone1.volume(0);}
				if (tone2){
					tempVol2=tone2.volume();
				tone2.volume(0);}
				if (tone3){
					tempVol3=tone3.volume();
				tone3.volume(0);}
				if (tone4){
					tempVol4=tone4.volume();
				tone4.volume(0);}

				tone1 = baseTone[chordNotes[0]+1];
				tone2 = baseTone[chordNotes[1]+1];
				tone3 = baseTone[chordNotes[2]+1];
				tone4 = baseTone[chordNotes[3]+1];

				tone1.volume(tempVol1);
				tone2.volume(tempVol2);
				tone3.volume(tempVol3);
				tone4.volume(tempVol4);

			}

			changeChord('D');









			var decreaseInterval=0.035;

			gyro.startTracking(function(o) {
				combinedXYZ=(Math.abs(o.x) + Math.abs(o.y) + Math.abs(o.z));
				combinedXYZnoABS=(o.x + o.y + o.z);
				trueLoudness = (combinedXYZ/12)-0.1;
				if (trueLoudness<loudness){
					loudness=loudness-decreaseInterval;
				}else{
					loudness=trueLoudness;
				}
				//loudness = 0.5;
				loudness=(combinedXYZ/12)-0.1;

				if (loudness <0) {loudness=0}
				var whichLoud;


				if (o.beta>90 || o.beta<-90){    //180 / -180 center point //face down
					if (tone4.volume() <=((Math.abs(o.beta)-90)/90)*(loudness)){
						tone4.volume(((Math.abs(o.beta)-90)/90)*(loudness));
						}else{tone4.volume(tone4.volume()-decreaseInterval)}
					}else{
						tone4.volume(tone4.volume()-decreaseInterval)
					}

					if (o.beta>0 && o.beta<180){ //90 center point
						if (tone1.volume() <= (Math.abs(Math.abs(o.beta-90)-90)/90)*(loudness)){
							tone1.volume((Math.abs(Math.abs(o.beta-90)-90)/90)*(loudness)) //straight up
							}else{tone1.volume(tone1.volume()-decreaseInterval)}

						}else{
							tone1.volume(tone1.volume()-decreaseInterval)
						}

						if (o.beta>-90 && o.beta<90){ //0 center point
							if (tone2.volume() <= (Math.abs(Math.abs(o.beta)-90)/90)*(loudness)){
								tone2.volume((Math.abs(Math.abs(o.beta)-90)/90)*(loudness)) //face up
								}else{tone2.volume(tone2.volume()-decreaseInterval)}

							}else{
								tone2.volume(tone2.volume()-decreaseInterval)
							}

							if (o.beta>-180 && o.beta<-0){ // -90 center point
								if (tone3.volume() <= (Math.abs(Math.abs(o.beta+90)-90)/90)*(loudness)){
									tone3.volume((Math.abs(Math.abs(o.beta+90)-90)/90)*(loudness)) //upside down
									}else{tone3.volume(tone3.volume()-decreaseInterval)}

								}else{
									tone3.volume(tone3.volume()-decreaseInterval)
								}

								if (tone4.volume() <decreaseInterval){tone4.volume(0);}
								if (tone3.volume() <decreaseInterval){tone3.volume(0);}
								if (tone2.volume() <decreaseInterval){tone2.volume(0);}
								if (tone1.volume() <decreaseInterval){tone1.volume(0);}


							});

						</script>
						<div id="foobar" style="font-size:20" onclick="changeChord('D');">D</div>
						<BR><BR><BR><BR><BR><BR><BR>

						<div id="foobar" style="font-size:20" onclick="changeChord('A');">A</div>
						<BR>
						<input type="text" onkeydown="tone1.volume(1);">
					</body>
				</html>
