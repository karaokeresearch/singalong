<html>
	<head>
		<title>Angle Strummer</title>
	</head>
	<body bgcolor="#CCCCFF">
		<div id="loading" style="font-size:4em">Loading...</div>

		<script type="text/javascript" src="../gyro.js"></script>
		<script type="text/javascript" src="../cookies.js"></script>
		<script type="text/javascript" src="../howler.js"></script>
		<script type="text/javascript" src="../ntpclient.js"></script>
		<script type="text/javascript" src="../teoria.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript" src="../playalong.js"></script>


		<script>
			var hasLoaded=false;
			var stringIDs=[];
			var chordNotes=[];


			var socket = io.connect();
			ntp.init(socket);      
			playalong.init(socket);
			var preload=150;      //how far in advance to pre-load chords (akin to how quickly a guitar player's left hand moves in anticipation of the chord change)
			var lagOverride=300 + preload;
			var playQueue=[];



			var changeChord = function (whichChord){
				chordNotes=[];
				var chord=teoria.chord(whichChord);
				for (i=0; i< chord.notes().length; i++) {
					chordNotes.push((chord.notes()[i].key()+4)%24);
				}
				for (i=0; i< chord.notes().length; i++) {
					chordNotes.push(((chord.notes()[i].key()+16)%24));
				}
				chordNotes.sort(function(a, b){return a-b});
			}


			noteLength=4000;
			var sound = new Howl({
				urls: ['strumAscendAmono.ogg' ],
				volume: 0.65,
				onload: function(){document.getElementById("loading").innerHTML = "Strum your phone like it was a pretend guitar!";
					hasLoaded=true;
				},
				sprite: {
					1 : [ 0*noteLength, 3800],
					2 : [ 1*noteLength, 3800],
					3 : [ 2*noteLength, 3800],
					4 : [ 3*noteLength, 3800],
					5 : [ 4*noteLength, 3800],
					6 : [ 5*noteLength, 3800],
					7 : [ 6*noteLength, 3800],
					8 : [ 7*noteLength, 3800],
					9 : [ 8*noteLength, 3800],
					10 : [ 9*noteLength, 3800],
					11 : [10*noteLength, 3800],
					12 : [11*noteLength, 3800],
					13 : [12*noteLength, 3800],
					14 : [13*noteLength, 3800],
					15 : [14*noteLength, 3800],
					16 : [15*noteLength, 3800],
					17 : [16*noteLength, 3800],
					18 : [17*noteLength, 3800],
					19 : [18*noteLength, 3800],
					20 : [19*noteLength, 3800],
					21 : [20*noteLength, 3800],
					22 : [21*noteLength, 3800],
					23 : [22*noteLength, 3800],
					24 : [23*noteLength, 3800]
				}
			});









			gyro.frequency=50;



			var previousAngle;

			gyro.startTracking(function(o) {
				if (hasLoaded){
					if ((o.beta >=-15 && previousAngle<-15) || (o.beta <=-15 && previousAngle>-15)){
						sound.play(chordNotes[1]+1);
					}

					if ((o.beta >=-5 && previousAngle<-5) || (o.beta <=-5 && previousAngle>-5)){
						sound.play(chordNotes[2]+1);
					}

					if ((o.beta >=5 && previousAngle<5) || (o.beta <=5 && previousAngle>5)){
						sound.play(chordNotes[3]+1);
					}

					if ((o.beta >=15 && previousAngle<15) || (o.beta <=15 && previousAngle>15)){
						sound.play(chordNotes[4]+1);
					}
				}

				previousAngle=o.beta;

			});


		</script>
	</body>
</html>
